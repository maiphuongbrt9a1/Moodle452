<?php
// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 * Version information for local_course_calendar
 *
 * @package    local_course_calendar
 * @copyright  2025 Võ Mai Phương <vomaiphuonghhvt@gmail.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */


// mycustompage.php (ví dụ)

require_once(__DIR__ . '/../../config.php'); // Luôn cần dòng này ở đầu


// Yêu cầu người dùng đăng nhập
require_login();

// Khai báo các biến toàn cục
global $PAGE, $OUTPUT, $DB, $USER;

// Lấy courseid từ URL hoặc từ ngữ cảnh (nếu trang của bạn liên quan đến khóa học)
$courseid = 4;
// ... (logic để kiểm tra và lấy thông tin khóa học nếu cần)
// Ví dụ:
$course = $DB->get_record('course', ['id' => $courseid], '*', MUST_EXIST);

// Thiết lập trang Moodle
$PAGE->set_url(new moodle_url('/local/myplugin/mycustompage.php', ['id' => $courseid])); // Đặt URL cho trang hiện tại
$PAGE->set_title(get_string('mypagetitle', 'local_myplugin')); // Tiêu đề trang
$PAGE->set_heading(get_string('mypageheading', 'local_myplugin')); // Tiêu đề lớn trên trang
$PAGE->navbar->add(get_string('mainlink', 'local_myplugin'), new moodle_url('/local/myplugin/index.php')); // Thêm một breadcrumb link chính
$PAGE->navbar->add(get_string('currentpagelink', 'local_myplugin')); // Thêm breadcrumb cho trang hiện tại

// mycustompage.php (tiếp tục)

// --- TẠO THANH ĐIỀU KHIỂN PHỤ (TABS) ---

// Nếu trang của bạn là một phần của trang khóa học và bạn muốn nó hiển thị
// dưới các tab của khóa học, bạn có thể thiết lập context là CONTEXT_COURSE.
$context = \context_course::instance($courseid);
$PAGE->set_context($context); // Đặt ngữ cảnh trang

// Lấy đối tượng course_navigation
$coursenavigation = $PAGE->settingsnav; // Lấy thanh điều hướng khóa học

// Thêm các tab/mục vào thanh điều hướng phụ (secondary navigation)
// Mỗi add() tạo ra một mục trên thanh điều khiển.
// Đảm bảo tên file, URL và string keys phù hợp với plugin của bạn.

// 1. Tab "Course" (trang tổng quan khóa học)
$url_course_overview = new moodle_url('/course/view.php', ['id' => $courseid]);
$coursenavigation->add(
    get_string('course', 'core_course'), // Ví dụ: 'Course' từ core_course
    $url_course_overview,
    \navigation_node::TYPE_CONTAINER, // Hoặc TYPE_COURSE
    'coursepage', // ID duy nhất cho node này
    'courseview' // Hành động (action) liên quan
);


// 2. Tab "Settings"
$url_settings = new moodle_url('/course/edit.php', ['id' => $courseid]);
$coursenavigation->add(
    get_string('settings'), // Hoặc get_string('settings', 'local_myplugin')
    $url_settings,
    \navigation_node::TYPE_SETTING,
    'coursesettings',
    'coursesettings'
);

// 3. Tab "Participants"
$url_participants = new moodle_url('/user/index.php', ['id' => $courseid]);
$coursenavigation->add(
    get_string('participants'),
    $url_participants,
    \navigation_node::TYPE_SETTING, // Có thể là TYPE_CONTAINER hoặc TYPE_PAGE
    'courseparticipants',
    'courseparticipants'
);

// 4. Tab "Grades"
$url_grades = new moodle_url('/grade/report/grader/index.php', ['id' => $courseid]);
$coursenavigation->add(
    get_string('grades'),
    $url_grades,
    \navigation_node::TYPE_SETTING,
    'coursegrades',
    'coursegrades'
);

// 5. Tab "Reports"
$url_reports = new moodle_url('/report/', ['id' => $courseid]); // Đây có thể là URL cơ sở cho các báo cáo
$coursenavigation->add(
    get_string('reports'),
    $url_reports,
    \navigation_node::TYPE_SETTING,
    'coursereports',
    'coursereports'
);

// 6. Tab "My Custom Page" (trang hiện tại của bạn)
// Quan trọng: Làm cho tab này 'active' để nó được highlight
$url_mycustompage = new moodle_url('/local/myplugin/mycustompage.php', ['id' => $courseid]);
$coursenavigation->add(
    get_string('mycustompagetitle', 'local_myplugin'), // Tên hiển thị của tab
    $url_mycustompage,
    \navigation_node::TYPE_SETTING, // Chọn loại node phù hợp
    'mycustompageid', // ID duy nhất cho tab này
    'mycustompageaction' // Action/ID để Moodle biết đây là tab hiện tại
);
// Đặt tab hiện tại là active
 // Phải khớp với action của node bạn vừa thêm

// --- KẾT THÚC THÊM TAB ---


echo $OUTPUT->header();

// Nội dung trang của bạn
echo $OUTPUT->box_start();
echo "<h1>Nội dung trang tùy chỉnh của bạn</h1>";
echo "<p>Đây là nội dung của trang " . get_string('mycustompagetitle', 'local_myplugin') . ".</p>";
echo $OUTPUT->box_end();

echo $OUTPUT->footer();
